name: Validate Manufacturers

on:
  push:
    branches: [ main, master ]
    paths:
      - 'tech-support-directory/data/manufacturers/**'
      - 'tech-support-directory/scripts/**'
  pull_request:
    branches: [ main, master ]
    paths:
      - 'tech-support-directory/data/manufacturers/**'
      - 'tech-support-directory/scripts/**'

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Validate manufacturer data
      working-directory: tech-support-directory
      run: |
        echo "ğŸ” Validating manufacturer data..."
        node scripts/validate.ts
    
    - name: Check for duplicates
      working-directory: tech-support-directory
      run: |
        echo "ğŸ” Checking for duplicate manufacturers..."
        node scripts/check-duplicates.ts
    
    - name: Build indexes
      working-directory: tech-support-directory
      run: |
        echo "ğŸ”¨ Building indexes..."
        node scripts/build-index.ts
    
    - name: Verify build artifacts
      working-directory: tech-support-directory
      run: |
        echo "âœ… Verifying build artifacts exist..."
        test -f dist/index.min.json || exit 1
        test -f dist/index.by-domain.json || exit 1
        test -f dist/shards/us-hvac.json || exit 1
        echo "âœ… All checks passed!"

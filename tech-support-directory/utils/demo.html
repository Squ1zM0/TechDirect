<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Helper Demo - Tech Directory</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .manufacturer-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .manufacturer-card h2 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 18px;
        }
        .manufacturer-card .website {
            color: #3498db;
            font-size: 14px;
            margin-bottom: 15px;
        }
        .phone-section {
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-top: 15px;
        }
        .phone-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .phone-number {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }
        .call-button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .call-button:hover {
            background: #229954;
        }
        .call-button:disabled,
        .not-callable {
            background: #95a5a6;
            cursor: not-allowed;
        }
        .department {
            color: #7f8c8d;
            font-size: 13px;
        }
        .country-badge {
            display: inline-block;
            background: #ecf0f1;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            color: #34495e;
            margin-top: 5px;
        }
        .test-results {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
        }
        .pass {
            color: #27ae60;
        }
        .fail {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <h1>ðŸ“ž Tech Directory - Phone Helper Demo</h1>
    
    <div class="test-results">
        <h2>Test Results</h2>
        <div id="test-output"></div>
    </div>

    <h2>Manufacturer Directory</h2>
    <div class="card-grid" id="manufacturer-grid"></div>

    <script type="module">
        // Phone helper functions (inline for demo)
        function formatPhone(phone) {
            if (!phone || typeof phone !== 'string') {
                return {
                    displayPhone: '',
                    callPhone: null,
                    isCallable: false
                };
            }

            const raw = phone.trim();
            
            if (!raw) {
                return {
                    displayPhone: '',
                    callPhone: null,
                    isCallable: false
                };
            }

            const displayPhone = raw;
            let sanitized = raw.replace(/[^\d+]/g, '');

            // Normalize multiple leading + signs to single +, remove + anywhere else
            sanitized = sanitized.replace(/^\++/, '+').replace(/(?<=.)\+/g, '');

            const digitCount = sanitized.replace(/\+/g, '').length;
            const isCallable = digitCount >= 7;

            return {
                displayPhone,
                callPhone: isCallable ? sanitized : null,
                isCallable
            };
        }

        // Sample manufacturer data
        const manufacturers = [
            {
                id: "hl-hutterer-lechner",
                name: "HL Hutterer & Lechner",
                website: "https://www.hutterer-lechner.com/",
                support: [{
                    category: "plumbing",
                    department: "International (Contact)",
                    phone: "+49-2932-9616-0",
                    country: "DE"
                }]
            },
            {
                id: "kessel",
                name: "KESSEL",
                website: "https://www.kessel.com/",
                support: [{
                    category: "plumbing",
                    department: "Headquarters (International)",
                    phone: "+49-8456-270",
                    country: "DE"
                }]
            },
            {
                id: "carrier",
                name: "Carrier",
                website: "https://www.carrier.com/",
                support: [{
                    category: "hvac",
                    department: "Contractor Support",
                    phone: "+1 800-227-7437",
                    country: "US"
                }]
            },
            {
                id: "trane",
                name: "Trane",
                website: "https://www.trane.com/",
                support: [{
                    category: "hvac",
                    department: "Technical Support",
                    phone: "(800) 554-2413",
                    country: "US"
                }]
            },
            {
                id: "test-short",
                name: "Test - Short Number",
                website: "https://example.com/",
                support: [{
                    category: "test",
                    department: "Test Department",
                    phone: "12345",
                    country: "XX"
                }]
            },
            {
                id: "test-dots",
                name: "Test - Dots Format",
                website: "https://example.com/",
                support: [{
                    category: "test",
                    department: "Test Department",
                    phone: "+1.800.555.0100",
                    country: "US"
                }]
            }
        ];

        // Run tests
        function runTests() {
            const testCases = [
                { input: '+1 800-555-1212', expected: '+18005551212', name: 'US with spaces/hyphens' },
                { input: '+49-2932-9616-0', expected: '+49293296160', name: 'DE with hyphens' },
                { input: '+49-8456-270', expected: '+498456270', name: 'DE short with hyphens' },
                { input: '(800) 555-1212', expected: '8005551212', name: 'US with parentheses' },
                { input: '+1.800.555.0100', expected: '+18005550100', name: 'US with dots' },
                { input: '12345', expected: null, name: 'Too short (not callable)' },
            ];

            let output = '';
            testCases.forEach(test => {
                const result = formatPhone(test.input);
                const pass = result.callPhone === test.expected;
                const status = pass ? '<span class="pass">âœ“</span>' : '<span class="fail">âœ—</span>';
                output += `<div class="test-case">
                    ${status} ${test.name}<br>
                    Input: "${test.input}"<br>
                    Expected: ${test.expected}<br>
                    Got: ${result.callPhone}<br>
                    Display: "${result.displayPhone}"
                </div>`;
            });

            document.getElementById('test-output').innerHTML = output;
        }

        // Render manufacturers
        function renderManufacturers() {
            const grid = document.getElementById('manufacturer-grid');
            
            manufacturers.forEach(mfr => {
                const support = mfr.support[0];
                const phoneData = formatPhone(support.phone);
                
                const card = document.createElement('div');
                card.className = 'manufacturer-card';
                
                card.innerHTML = `
                    <h2>${mfr.name}</h2>
                    <div class="website">${mfr.website}</div>
                    
                    <div class="phone-section">
                        <div class="department">${support.department}</div>
                        
                        ${phoneData.displayPhone ? `
                            <div class="phone-display">
                                <div class="phone-number">ðŸ“ž ${phoneData.displayPhone}</div>
                                ${phoneData.isCallable ? `
                                    <a href="tel:${phoneData.callPhone}" class="call-button">
                                        Call
                                    </a>
                                ` : `
                                    <button class="call-button not-callable" disabled>
                                        Not Callable
                                    </button>
                                `}
                            </div>
                        ` : ''}
                        
                        <div class="country-badge">${support.country}</div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Initialize
        runTests();
        renderManufacturers();
    </script>
</body>
</html>
